import React, { useEffect, useState } from 'react';
import axios from 'axios';
const columns = [{ key: 'Born', title: 'Born' },{ key: 'PeerReview', title: 'Peer Review' },{ key: 'ExpertReview', title: 'Expert Review' },{ key: 'Accepted', title: 'Accepted' },{ key: 'InWork', title: 'In Work' },{ key: 'OnHold', title: 'On Hold' },{ key: 'Rejected', title: 'Rejected' }];
export default function BoardPage(){ const [map,setMap]=useState({}); useEffect(()=>{ fetchIdeas(); },[]); async function fetchIdeas(){ try{ const res = await axios.get((import.meta.env.VITE_API_URL||'http://localhost:5000') + '/api/ideas'); const ideas = res.data; const m = {}; columns.forEach(c=>m[c.key]=[]); ideas.forEach(i=>{ const s=i.status||'Born'; if(!m[s]) m[s]=[]; m[s].push(i); }); setMap(m); }catch(e){ alert('Error fetching ideas'); } } function onDragStart(e,id,from){ e.dataTransfer.setData('text/plain', JSON.stringify({id,from})); } async function onDrop(e,to){ e.preventDefault(); const data = JSON.parse(e.dataTransfer.getData('text/plain')); const token = localStorage.getItem('token'); try{ await axios.post((import.meta.env.VITE_API_URL||'http://localhost:5000') + '/api/ideas/' + data.id + '/status', { status: to }, { headers: { Authorization: 'Bearer '+token } }); fetchIdeas(); }catch(err){ alert('Not allowed or error'); fetchIdeas(); } } return (<div className="container"><div className="nav"><div className="brand"><h1>Idea Portal</h1></div><div></div></div><div style={{height:24}} /><div style={{display:'grid', gridTemplateColumns:'repeat(3,1fr)', gap:12}}>{columns.map(col=>(<div key={col.key} className="card" onDragOver={(e)=>e.preventDefault()} onDrop={(e)=>onDrop(e,col.key)}><h4>{col.title} ({(map[col.key]||[]).length})</h4>{(map[col.key]||[]).map(i=>(<div key={i._id} draggable onDragStart={(e)=>onDragStart(e,i._id,col.key)} className="card" style={{marginBottom:8}}><strong>{i.title}</strong><div className="small">by {i.author?.name}</div></div>))}</div>))}</div></div>); }
